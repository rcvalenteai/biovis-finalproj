<!DOCTYPE html>
<html>
    <head>
        <style>
            .ingredient-circle {
                fill-opacity: .25;
                stroke-width: 2px;
            }
            .recipe-circle {
                fill-opacity: .8;
                stroke-width: 1.5px;
            }
        </style>
    </head>
    <body>
        <script src="https://d3js.org/d3.v5.min.js"></script>
        <script>
            foodNameData = ["grilled chicken", "kung pao chicken", "peking duck", "carne asada borrito", "surf and turf"]
            foodData = [10, 20, 30, 40, 50]
            ingredients = ["salt"]

            svg = d3.select("body").append("svg");
            g = svg.append("g");

            pack = d3.pack()
            .padding(function(d) {
                return d.height*4;
            });

            let root = d3.hierarchy(reformatData())
            .sum(function(d) {
                return d.value;
            });

            diameter = Math.min(innerWidth, innerHeight);
            width = diameter;
            height = diameter;

            svg.attr("width", width)
                .attr("height", height);

            pack.size([width, height]);

            node = pack(root);
            recipeNodes = node.leaves();
            ingredientNodes = node.ancestors();

            ingredientBubbles = g.selectAll(".ingredient-circle")
            .data(ingredientNodes[0].children, function(d) {
                return d.data.name;
            });

            ingredientBubbles.enter().append("circle")
                .style("fill",   function(d) { return "rgb(102, 194, 165)"; })
                .style("stroke", function(d) { return "rgb(102, 194, 165)"; })
                .attr("class", "ingredient-circle")
                .attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; })
                .attr("r",  function(d) { return d.r; })
                .text(function(d){return d.data.name});

            recipeBubbles = g.selectAll(".recipe-circle")
            .data(recipeNodes, function(d) {
                return d.data.name;
            });

            recipeBubbles.enter().append("circle")
                .style("fill",   function(d) { return "rgb(102, 194, 165)"; })
                .style("stroke", function(d) { return "rgb(102, 194, 165)"; })
                .attr("class", "recipe-circle")
                .attr("cx", function(d) { return d.x; })
                .attr("cy", function(d) { return d.y; })
                .attr("r",  function(d) { return d.r; });

            recipeBubbles.enter().append("text")
                .text(function(d) {
                console.log(d.data.name)
                return d.data.name
            }).attr("text-anchor", "middle")
                .attr("dy", function(d) {
                return d.y;
            }).attr("dx", function(d) {
                return d.x;
            }).attr("font-size", function(d) {
                return d.r / 5;
            });

            function reformatData(){
                reformatted = {
                    name: "root",
                    children: ingredients.map(name => {
                        return {
                            name,
                            children: d3.range(5).map(function(d, i) {
                                return {
                                    name: foodNameData[i],
                                    value: foodData[i]
                                }
                            })
                        }
                    })
                };
                console.log(reformatted)
                return reformatted
            }
        </script>
    </body>
</html>